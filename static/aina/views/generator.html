<!-- GENERATOR PARTIAL -->
<div class="h-screen w-full flex overflow-hidden bg-[#1e1e1e] text-[#cccccc] font-sans" 
     x-data="generatorManager('{{ slug }}')"
     x-init="init()">

    <!-- 1. LEFT SIDEBAR: Component Library -->
    <div class="w-80 flex flex-col border-r border-[#3e3e42] bg-[#252526] shrink-0 z-20">
        
        <!-- Header & Search -->
        <div class="p-4 border-b border-[#3e3e42] bg-[#252526]">
            <div class="flex justify-between items-center mb-3">
                <span class="text-xs font-bold uppercase tracking-widest text-gray-500">Library</span>
                <span class="text-[10px] text-[#007acc] font-mono" x-text="codeRoutes.length + ' found'"></span>
            </div>
            <div class="relative group">
                <i class="fas fa-search absolute left-3 top-2 text-gray-500 group-focus-within:text-[#007acc] transition"></i>
                <input type="text" x-model="searchQuery" 
                       placeholder="Search components..." 
                       class="w-full bg-[#3c3c3c] border border-transparent focus:border-[#007acc] text-sm text-white rounded px-9 py-1.5 focus:outline-none transition">
            </div>
        </div>

        <!-- Categories -->
        <div class="flex overflow-x-auto gap-1 p-2 border-b border-[#3e3e42] custom-scrollbar bg-[#1e1e1e]">
            <button @click="activeCategory = 'All'"
                    :class="activeCategory === 'All' ? 'bg-[#37373d] text-white border-gray-500' : 'text-gray-500 border-transparent hover:text-gray-300'"
                    class="px-3 py-1 text-[10px] font-bold uppercase whitespace-nowrap border rounded-full transition">
                All
            </button>
            <template x-for="(items, catName) in categories" :key="catName">
                <!-- Hide Media from here, it has its own panel -->
                <button x-show="catName !== 'Media'" 
                        @click="activeCategory = catName"
                        :class="activeCategory === catName ? 'bg-[#37373d] text-white border-gray-500' : 'text-gray-500 border-transparent hover:text-gray-300'"
                        class="px-3 py-1 text-[10px] font-bold uppercase whitespace-nowrap border rounded-full transition"
                        x-text="catName">
                </button>
            </template>
        </div>

        <!-- List View -->
        <div class="flex-1 overflow-y-auto custom-scrollbar">
            <template x-for="route in codeRoutes" :key="route.slug">
                <div @click="toggleComponent(route.slug)"
                     class="group border-b border-[#2d2d2d] px-4 py-3 cursor-pointer hover:bg-[#2a2d2e] transition relative select-none"
                     :class="isSelected(route.slug) ? 'bg-[#37373d]/30' : ''">
                    
                    <div class="flex items-start justify-between gap-3">
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-2 mb-1">
                                <i class="fas fa-cube text-[10px]" :class="isSelected(route.slug) ? 'text-[#007acc]' : 'text-gray-600'"></i>
                                <span class="text-sm font-medium truncate text-gray-200" 
                                      :class="isSelected(route.slug) ? 'text-[#4fc1ff]' : ''"
                                      x-text="route.name"></span>
                            </div>
                            <p class="text-[11px] text-gray-500 truncate" x-text="route.description || 'System component'"></p>
                        </div>

                        <!-- Status Pill -->
                        <div class="shrink-0">
                            <div class="px-2 py-0.5 rounded text-[10px] font-bold border transition-all duration-200"
                                 :class="isSelected(route.slug) 
                                    ? 'bg-[#007acc]/20 border-[#007acc] text-[#4fc1ff]' 
                                    : 'bg-[#2d2d2d] border-[#3e3e42] text-gray-500 group-hover:border-gray-500'">
                                <span x-text="isSelected(route.slug) ? 'INSTALLED' : 'ADD'"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </div>

<!-- 2. CENTER PANE: The Real Editor (Raw Data Preview) -->
    <div class="flex-1 flex flex-col min-w-0 bg-[#1e1e1e] relative z-0">
        
        <!-- Toolbar -->
        <div class="h-10 bg-[#1e1e1e] flex items-center px-4 border-b border-[#3e3e42] select-none justify-between shrink-0">
            <div class="flex items-center gap-2 px-3 py-1.5 bg-[#1e1e1e] text-[#e0e0e0] border-t border-[#007acc] text-xs font-medium">
                <i class="fas fa-file-code text-[#e37933]"></i>
                <span>FINAL OUTPUT PREVIEW</span>
            </div>
            
            <div class="flex items-center gap-2 text-xs font-mono transition-colors duration-500"
                 :class="{
                    'text-gray-600': autosaveStatus === 'Ready',
                    'text-[#e37933]': autosaveStatus === 'Saving...',
                    'text-green-500': autosaveStatus === 'Saved',
                    'text-red-500': autosaveStatus === 'Error'
                 }">
                <i class="fas" :class="{
                    'fa-check': autosaveStatus === 'Saved',
                    'fa-circle-notch fa-spin': autosaveStatus === 'Saving...',
                    'fa-circle text-[6px]': autosaveStatus === 'Ready' || autosaveStatus === 'Error'
                }"></i>
                <span x-text="autosaveStatus"></span>
            </div>
        </div>

        <!-- The Code View -->
        <div class="flex-1 overflow-auto custom-scrollbar bg-[#1e1e1e] p-6 font-mono text-sm leading-relaxed">
            
            <!-- File Header -->
            <div class="text-[#6a9955] select-none">/**</div>
            <div class="text-[#6a9955] select-none"> * Auto-Generated by Aina</div>
            <div class="text-[#6a9955] select-none" x-text="' * Updated: ' + new Date().toLocaleTimeString()"></div>
            <div class="text-[#6a9955] select-none"> */</div>
            <br>

            <template x-for="item in activeComponentsList" :key="item.slug">
                <!-- Wrap each item in its own local collapse state -->
                <div x-data="{ isCollapsed: false }" 
                    class="mb-6 group relative pl-4 border-l-2 border-[#3e3e42] hover:border-[#007acc] transition-colors">
                    
                    <!-- Toggle Header (Markers + Name) -->
                    <div @click="isCollapsed = !isCollapsed" class="cursor-pointer select-none group/header">
                        
                        <!-- Start Marker with Chevron -->
                        <div class="text-[#569cd6] text-xs opacity-50 mb-1 flex items-center gap-2">
                            <i class="fas fa-chevron-down transition-transform duration-200" 
                            :class="isCollapsed ? '-rotate-90' : ''"></i>
                            <span x-text="'// [AINA:' + item.slug + ']'"></span>
                            <span x-show="isCollapsed" class="text-[10px] bg-[#3e3e42] px-1 rounded text-gray-400">... hidden</span>
                        </div>
                        
                        <!-- Readable Header -->
                        <div class="flex items-center gap-2 text-[#6a9955] font-bold mb-1 group-hover/header:brightness-125">
                            <span x-text="'// --- ' + item.name + ' ---'"></span>
                        </div>
                    </div>

                    <!-- Collapsible Content -->
                    <div x-show="!isCollapsed" 
                        x-transition:enter="transition ease-out duration-150"
                        x-transition:enter-start="opacity-0 -translate-y-2"
                        x-transition:enter-end="opacity-100 translate-y-0">
                        
                        <!-- Code Content -->
                        <pre class="text-[#d4d4d4] whitespace-pre-wrap break-words font-mono mt-2" x-text="item.data.trim()"></pre>
                        
                        <!-- End Marker -->
                        <div class="text-[#569cd6] text-xs select-none opacity-50 mt-1" x-text="'// [/AINA:' + item.slug + ']'"></div>
                    </div>

                    <!-- Floating Remove Button (use .stop to prevent toggling collapse when deleting) -->
                    <button @click.stop="toggleComponent(item.slug)" 
                            class="absolute top-0 right-0 opacity-0 group-hover:opacity-100 transition 
                                text-xs bg-[#252526] hover:bg-red-900/50 text-gray-400 hover:text-white 
                                border border-[#3e3e42] hover:border-red-500 px-2 py-1 rounded shadow-lg">
                        <i class="fas fa-trash-alt mr-1"></i> Remove
                    </button>
                </div>
            </template>
            
            <!-- Empty State -->
            <div x-show="activeComponentsList.length === 0" class="text-gray-600 italic mt-8 text-center select-none">
                <i class="fas fa-arrow-left mr-2"></i>
                Select components or assets to inject code.
            </div>

            <br>
        </div>
    </div>

    <!-- 3. RIGHT SIDEBAR: Media Gallery -->
    <div class="w-64 bg-[#1e1e1e] border-l border-[#3e3e42] flex flex-col shrink-0 z-10">
        <div class="p-3 border-b border-[#3e3e42] flex items-center justify-between">
            <span class="text-[10px] font-bold text-gray-500 uppercase tracking-widest">Assets</span>
            <!-- Sync/Refresh Button -->
            <button @click="fetchRoutes()" class="text-gray-500 hover:text-white transition">
                <i class="fas fa-sync-alt text-[10px]" :class="isLoading ? 'fa-spin' : ''"></i>
            </button>
        </div>

        <div class="flex-1 overflow-y-auto p-2 custom-scrollbar">
            <div class="grid grid-cols-1 gap-3">
                <template x-for="route in mediaRoutes" :key="route.slug">
                    <div @click="toggleComponent(route.slug)"
                         class="relative group rounded-sm overflow-hidden border cursor-pointer transition-all duration-200"
                         :class="isSelected(route.slug) 
                            ? 'border-[#007acc] ring-1 ring-[#007acc] opacity-100' 
                            : 'border-[#3e3e42] opacity-60 hover:opacity-100 hover:border-gray-500'">
                        
                        <!-- Image -->
                        <div class="aspect-square bg-black relative flex items-center justify-center">
                            <div class="absolute inset-0 opacity-20" style="background-image: radial-gradient(#444 1px, transparent 1px); background-size: 8px 8px;"></div>
                            <img :src="extractUrl(route.data)" class="max-w-full max-h-full object-contain relative z-10">
                            
                            <!-- Checkmark Overlay -->
                            <div class="absolute inset-0 bg-[#007acc]/40 flex items-center justify-center backdrop-blur-sm transition-opacity duration-200"
                                 :class="isSelected(route.slug) ? 'opacity-100' : 'opacity-0'">
                                <i class="fas fa-check text-white text-xl drop-shadow-md"></i>
                            </div>
                        </div>

                        <!-- Name -->
                        <div class="bg-[#252526] p-2">
                            <div class="text-[9px] text-gray-400 truncate text-center" x-text="route.name.replace('Media: ', '')"></div>
                        </div>
                    </div>
                </template>
            </div>
        </div>
    </div>

</div>
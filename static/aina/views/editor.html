<div class="h-full flex flex-col bg-[#1e1e1e] text-[#cccccc] relative select-none" 
     x-data="editorManager('{{ slug }}', { 
         html: '', 
         css: '' 
     })"
     @mouseup.window="stopDrag()"
     @mousemove.window="handleDrag($event)"
>
    <!-- TOP BAR -->
    <div class="h-10 bg-[#252526] border-b border-[#3e3e42] flex items-center px-4 justify-between shrink-0">
        <div class="text-sm font-bold tracking-wide flex items-center gap-2">
            <span class="text-[#007acc]">IDE</span> 
            <span class="text-gray-500">/</span> 
            <span x-text="slug" class="font-mono text-xs text-gray-300"></span>
        </div>
        
        <div class="flex gap-2">
            <!-- VIEW TOGGLES -->
            <div class="flex bg-[#3e3e42] rounded mr-2">
                <button @click="toggleCss()" 
                        class="px-2 py-1.5 text-xs hover:text-white transition"
                        :class="showCss ? 'text-blue-400 font-bold' : 'text-gray-400'"
                        title="Toggle CSS Pane">
                    CSS
                </button>
                <div class="w-px bg-[#1e1e1e]"></div>
                <button @click="togglePreview()" 
                        class="px-2 py-1.5 text-xs hover:text-white transition"
                        :class="showPreview ? 'text-green-400 font-bold' : 'text-gray-400'"
                        title="Toggle Preview Pane">
                    Preview
                </button>
            </div>

            <button @click="copyPrompt()" 
                    class="bg-[#3e3e42] hover:bg-[#4e4e52] text-gray-300 text-xs font-bold px-3 py-1.5 rounded flex items-center gap-2 transition">
                <i class="fas" :class="copiedPrompt ? 'fa-check text-green-400' : 'fa-terminal'"></i>
            </button>

            <button @click="syncAndRender()" 
                    class="bg-[#2d2d2d] hover:bg-[#3d3d3d] border border-gray-600 text-white text-xs font-bold px-3 py-1.5 rounded flex items-center gap-2 transition disabled:opacity-50"
                    :disabled="isProcessing">
                <i class="fas" :class="isProcessing ? 'fa-circle-notch fa-spin' : 'fa-play'"></i>
                <span x-text="isProcessing ? 'Syncing...' : 'Run'"></span>
            </button>

            <button @click="deployHtml()" 
                    class="bg-[#0e639c] hover:bg-[#1177bb] text-white text-xs font-bold px-3 py-1.5 rounded flex items-center gap-2 transition disabled:opacity-50"
                    :disabled="isProcessing">
                <i class="fas fa-cloud-upload-alt"></i>
                <span>Deploy</span>
            </button>
        </div>
    </div>

    <!-- MAIN WORKSPACE -->
    <div class="flex-1 flex overflow-hidden w-full relative" x-ref="workspaceContainer">
        
        <!-- LEFT: EDITORS -->
        <!-- Logic: If Preview is hidden, this takes 100%. Otherwise it uses leftWidth % -->
        <div class="flex flex-col border-r border-[#3e3e42] min-w-[200px]"
             :style="showPreview ? ('width: ' + leftWidth + '%') : 'width: 100%'">
            
            <!-- HTML Pane (Top) -->
            <div class="flex flex-col min-h-[50px]" 
                 :class="showCss ? 'flex-1' : 'h-full'">
                <div class="bg-[#252526] px-4 py-2 text-xs font-bold border-b border-[#3e3e42] flex justify-between items-center select-none group">
                    <span>HTML (Body)</span>
                    <span class="text-[10px] font-normal text-gray-500 opacity-0 group-hover:opacity-100 transition">Locked: &lt;head&gt;</span>
                </div>
                <div x-ref="htmlEditor" class="flex-1"></div>
            </div>

            <!-- Vertical Resizer Handle (Only visible if CSS is shown) -->
            <div x-show="showCss"
                 @mousedown.prevent="startDrag($event, 'vertical')"
                 class="h-1 bg-[#252526] hover:bg-[#007acc] cursor-row-resize z-10 transition-colors duration-200 shrink-0">
            </div>

            <!-- CSS Pane (Bottom) -->
            <div class="flex flex-col min-h-[50px] border-t border-[#3e3e42]"
                 x-show="showCss"
                 :style="'height: ' + cssHeight + '%'">
                <div class="bg-[#252526] px-4 py-2 text-xs font-bold border-b border-[#3e3e42] flex justify-between items-center select-none group">
                    <span>CSS</span>
                    <span class="text-[10px] font-normal text-gray-500 opacity-0 group-hover:opacity-100 transition">Supports @apply</span>
                </div>
                <div x-ref="cssEditor" class="flex-1"></div>
            </div>
        </div>

        <!-- Horizontal Resizer Handle (Only visible if Preview is shown) -->
        <div x-show="showPreview"
             @mousedown.prevent="startDrag($event, 'horizontal')"
             class="w-1 bg-[#1e1e1e] hover:bg-[#007acc] cursor-col-resize z-10 transition-colors duration-200 shrink-0 border-l border-[#3e3e42]">
        </div>

        <!-- RIGHT: PREVIEW -->
        <div class="flex flex-col bg-white min-w-[200px]"
             x-show="showPreview"
             :style="'width: ' + (100 - leftWidth) + '%'"
             class="flex-1">
            
            <!-- Browser Chrome Mockup -->
            <div class="bg-[#f0f0f0] p-2 border-b border-gray-300 flex items-center gap-2 text-xs text-gray-500 select-none">
                <div class="flex gap-1.5 mr-2">
                    <div class="w-2.5 h-2.5 rounded-full bg-[#ff5f56]"></div>
                    <div class="w-2.5 h-2.5 rounded-full bg-[#ffbd2e]"></div>
                    <div class="w-2.5 h-2.5 rounded-full bg-[#27c93f]"></div>
                </div>
                <div class="flex-1 bg-white px-3 py-0.5 rounded border border-gray-200 flex items-center justify-between text-gray-400 font-mono text-[11px]">
                    <div class="flex items-center overflow-hidden">
                        <i class="fas fa-lock text-[9px] mr-1.5"></i> 
                        <span x-text="'/page/' + slug" class="truncate"></span>
                    </div>
                    <div class="flex items-center gap-1 shrink-0">
                        <div class="w-1.5 h-1.5 rounded-full" :class="isProcessing ? 'bg-yellow-400 animate-pulse' : 'bg-green-500'"></div>
                        <span x-text="statusText"></span>
                    </div>
                </div>
            </div>
            
            <div class="relative flex-1 w-full h-full">
                <!-- Transparent overlay during drag to prevent iframe swallowing events -->
                <div x-show="dragType !== null" class="absolute inset-0 z-50 bg-transparent"></div>
                
                <iframe x-ref="previewFrame" 
                        class="w-full h-full border-none block bg-white" 
                        sandbox="allow-scripts allow-same-origin">
                </iframe>
            </div>
        </div>
    </div>
</div>
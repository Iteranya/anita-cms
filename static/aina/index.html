<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aina IDE - {{ slug }}</title>
    
    <!-- Dependencies -->
    <script src="/static/hikarin/lib/tailwind.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script defer src="https://unpkg.com/htmx.org@1.9.10"></script>
    
    <!-- Tailwind Config for Dark Mode IDE -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        ide: { 
                            bg: '#1e1e1e', 
                            panel: '#252526', 
                            border: '#3e3e42',
                            accent: '#007acc'
                        }
                    }
                }
            }
        }
    </script>

    <style>
        [x-cloak] { display: none !important; }
        /* VS Code style scrollbars */
        ::-webkit-scrollbar { width: 10px; height: 10px; }
        ::-webkit-scrollbar-track { background: #1e1e1e; }
        ::-webkit-scrollbar-thumb { background: #424242; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #4f4f4f; }
        
        .htmx-swapping { opacity: 0; transition: opacity 0.1s ease-out; }
    </style>
</head>

<body 
    class="bg-ide-bg text-[#cccccc] font-sans h-screen overflow-hidden flex flex-col"
    x-data="ainaShell"
    hx-boost="true"
>

    <!-- TOP NAVIGATION BAR (Replaces Sidebar) -->
    <header class="h-10 bg-ide-panel border-b border-ide-border flex items-center justify-between px-4 shrink-0 select-none z-50">
        
        <!-- Left: Back & Title -->
        <div class="flex items-center gap-4 w-64">
            <a href="/admin/page" hx-boost="false" class="text-gray-400 hover:text-white transition">
                <i class="fas fa-arrow-left"></i>
            </a>
            <div class="text-sm font-bold tracking-wide flex items-center gap-2">
                <span class="text-ide-accent">Aina</span> 
                <span class="text-gray-600">/</span> 
                <span class="font-mono text-xs text-gray-300">{{ slug }}</span>
            </div>
        </div>

        <!-- Center: TABS (The "Sidebar" Logic) -->
        <nav class="flex bg-ide-bg rounded p-0.5 border border-ide-border">

            <!-- GENERATOR TAB -->
            <a href="/aina/generator/{{ slug }}" 
            hx-target="#app-content" 
            hx-swap="innerHTML"
            hx-push-url="true"
            @click="$store.ainaState.isSaving && ($event.preventDefault(), $store.notifications.add({ type: 'error', message: 'Wait for save.' }))"
            class="px-6 py-1 text-xs font-bold rounded-sm transition flex items-center gap-2 cursor-pointer"
            :class="{
                'bg-[#37373d] text-white shadow-sm': isActive('/generator/'),
                'text-gray-500 hover:text-gray-300': !isActive('/generator/'),
                'opacity-50 cursor-not-allowed': $store.ainaState.isSaving
            }">
                <i class="fas fa-cubes"></i> Generator
            </a>

            <!-- EDITOR TAB -->
            <a href="/aina/editor/{{ slug }}" 
            hx-target="#app-content" 
            hx-swap="innerHTML"
            hx-push-url="true"
            @click="$store.ainaState.isSaving && ($event.preventDefault(), $store.notifications.add({ type: 'error', message: 'Wait for save.' }))"
            class="px-6 py-1 text-xs font-bold rounded-sm transition flex items-center gap-2 cursor-pointer"
            :class="{
                'bg-[#37373d] text-white shadow-sm': isActive('/editor/'),
                'text-gray-500 hover:text-gray-300': !isActive('/editor/'),
                'opacity-50 cursor-not-allowed': $store.ainaState.isSaving
            }">
                <i class="fas fa-code"></i> IDE
            </a>

            <!-- SETTING TAB -->
            <a href="/aina/setting/{{ slug }}" 
            hx-target="#app-content" 
            hx-swap="innerHTML"
            hx-push-url="true"
            @click="$store.ainaState.isSaving && ($event.preventDefault(), $store.notifications.add({ type: 'error', message: 'Wait for save.' }))"
            class="px-6 py-1 text-xs font-bold rounded-sm transition flex items-center gap-2 cursor-pointer"
            :class="{
                'bg-[#37373d] text-white shadow-sm': isActive('/setting/'),
                'text-gray-500 hover:text-gray-300': !isActive('/setting/'),
                'opacity-50 cursor-not-allowed': $store.ainaState.isSaving
            }">
                <i class="fas fa-shield-alt"></i> Setting
            </a>

        </nav>

        <!-- Right: Status/User -->
        <div class="w-64 flex justify-end">
            <!-- Optional Actions -->
        </div>
    </header>

    <!-- CONTENT AREA -->
    <main id="app-content" class="flex-1 flex flex-col min-w-0 overflow-hidden relative">
        <!-- Initial Load Spinner -->
        <div class="flex h-full items-center justify-center text-gray-500">
            <i class="fas fa-circle-notch fa-spin text-3xl"></i>
        </div>
    </main>

    <!-- NOTIFICATION CONTAINER (Shared) -->
    <div class="fixed bottom-6 right-6 z-50 flex flex-col gap-3 pointer-events-none">
        <template x-for="note in $store.notifications.items" :key="note.id">
            <div x-show="true" class="pointer-events-auto w-80 shadow-2xl rounded overflow-hidden border border-ide-border flex items-stretch bg-ide-panel text-white">
                <div class="w-10 flex items-center justify-center flex-shrink-0"
                     :class="note.type === 'error' ? 'bg-red-600' : 'bg-green-600'">
                    <i class="fas" :class="note.type === 'error' ? 'fa-exclamation' : 'fa-check'"></i>
                </div>
                <div class="flex-1 p-3">
                    <div class="text-xs font-bold" x-text="note.title || (note.type === 'error' ? 'Error' : 'Success')"></div>
                    <div class="text-[11px] text-gray-400 mt-0.5" x-text="note.message"></div>
                </div>
                <button @click="$store.notifications.remove(note.id)" class="px-3 text-gray-500 hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </template>
    </div>
    
    <!-- Alpine Modules -->
    

    <!-- Restore View Logic (Same as Admin) -->
    <script type="module" src="/static/aina/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const path = window.location.pathname;
            
            // If we are at the root shell but the URL points to a sub-view (editor or generator)
            // Trigger HTMX to load that content immediately.
            if(path.includes('/aina/')) {
                console.log("Aina: Restoring view for", path);
                const antiCacheUrl = path + "?t=" + Date.now();
                htmx.ajax('GET', antiCacheUrl, {
                    target: '#app-content', 
                    swap: 'innerHTML'
                });
            }
        });
    </script>
</body>
</html>
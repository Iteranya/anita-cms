<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anita Admin | Forms</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Nunito', 'sans-serif'] },
                    colors: {
                        anita: {
                            50: '#f0f9ff', 100: '#e0f2fe', 200: '#bae6fd', 300: '#7dd3fc',
                            400: '#38bdf8', 500: '#0ea5e9', 600: '#0284c7', 700: '#0369a1',
                        }
                    }
                }
            }
        }
    </script>

    <style>
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        
        .glass-effect { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        
        /* Animations */
        @keyframes slideIn { from { transform: translateY(10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .animate-slide-in { animation: slideIn 0.3s ease-out forwards; }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 font-sans h-screen overflow-hidden flex">

    <!-- 1. LEFT SIDEBAR -->
    <aside class="w-64 bg-slate-900 text-white flex flex-col flex-shrink-0 transition-all duration-300 z-20">
        <!-- Logo Area -->
        <div class="h-16 flex items-center px-6 border-b border-slate-800 bg-slate-950">
            <img src="/media/anita.jpg" class="h-8 w-8 rounded-full border border-anita-500 mr-3" alt="Logo">
            <span class="font-bold text-lg tracking-wide">Anita CMS</span>
        </div>

        <!-- Navigation -->
        <nav class="flex-1 overflow-y-auto py-4 space-y-1 px-3">
            
            <a href="/admin/page/" class="flex items-center px-3 py-2.5 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors group">
                <i class="fas fa-layer-group w-6 text-center text-lg group-hover:text-blue-400"></i>
                <span class="ml-3 font-medium">Pages</span>
            </a>

            <!-- ACTIVE: Forms -->
            <a href="/admin/forms/" class="flex items-center px-3 py-2.5 bg-anita-600 text-white rounded-lg shadow-lg shadow-anita-900/20 transition-colors group">
                <i class="fas fa-inbox w-6 text-center text-lg"></i>
                <span class="ml-3 font-semibold">Forms</span>
            </a>

            <a href="/admin/media/" class="flex items-center px-3 py-2.5 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors group">
                <i class="fas fa-images w-6 text-center text-lg group-hover:text-purple-400"></i>
                <span class="ml-3 font-medium">Images</span>
            </a>

            <a href="/admin/files/" class="flex items-center px-3 py-2.5 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors">
                <i class="fas fa-folder-open w-6 text-center text-lg"></i>
                <span class="ml-3 font-medium">Files</span>
            </a>

            <div class="pt-4 pb-2">
                <p class="px-3 text-xs font-bold text-slate-500 uppercase tracking-wider">System</p>
            </div>

            <a href="/admin/config/" class="flex items-center px-3 py-2.5 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors group">
                <i class="fas fa-robot w-6 text-center text-lg group-hover:text-gray-300"></i>
                <span class="ml-3 font-medium">AI Config</span>
            </a>
            <a href="/admin/users/" class="flex items-center px-3 py-2.5 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors group">
                <i class="fas fa-users-cog w-6 text-center text-lg"></i>
                <span class="ml-3 font-semibold">Users & Roles</span>
            </a>
        </nav>
    </aside>

    <!-- 2. MAIN CONTENT -->
    <main class="flex-1 flex flex-col min-w-0 overflow-hidden">
        
        <!-- Header -->
        <header class="bg-white border-b border-slate-200 h-16 flex items-center justify-between px-8 shadow-sm z-10">
            <div>
                <h1 class="text-xl font-bold text-slate-800">Forms Builder</h1>
                <p class="text-xs text-slate-500">Manage API forms and view submissions</p>
            </div>
            <div class="flex items-center gap-4">
                <button onclick="openModal('create')" class="bg-slate-900 hover:bg-slate-800 text-white px-4 py-2 rounded-lg shadow-lg transition-all transform hover:-translate-y-0.5 font-bold text-sm flex items-center">
                    <i class="fas fa-plus mr-2"></i> New Form
                </button>
            </div>
        </header>

        <!-- Content Area -->
        <div class="flex-1 overflow-y-auto p-8">
            
            <!-- Loader -->
            <div id="forms-loader" class="flex justify-center items-center h-64">
                <i class="fas fa-circle-notch fa-spin text-4xl text-anita-400"></i>
            </div>

            <!-- Forms Grid -->
            <div id="forms-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 hidden">
                <!-- Cards injected via JS -->
            </div>

        </div>
    </main>

    <!-- 3. FORM EDITOR/VIEWER MODAL -->
    <div id="form-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity" onclick="closeModal()"></div>
        
        <!-- Modal Content -->
        <div class="relative bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col animate-slide-in border border-slate-100">
            
            <!-- Header -->
            <div class="flex justify-between items-center px-6 py-4 border-b border-slate-100">
                <h3 id="modal-title" class="text-xl font-bold text-slate-800">Design Form</h3>
                <button onclick="closeModal()" class="text-slate-400 hover:text-red-500 transition"><i class="fas fa-times text-xl"></i></button>
            </div>

            <!-- Tabs -->
            <div class="flex border-b border-slate-100 px-6 bg-slate-50/50">
                <button class="tab-btn active px-4 py-3 text-sm font-bold border-b-2 border-anita-600 text-anita-600 transition-colors" data-tab="settings">
                    <i class="fas fa-sliders-h mr-1"></i> Settings
                </button>
                <button class="tab-btn px-4 py-3 text-sm font-bold border-b-2 border-transparent text-slate-500 hover:text-slate-700 transition-colors" data-tab="builder">
                    <i class="fas fa-tools mr-1"></i> Builder
                </button>
                <button class="tab-btn px-4 py-3 text-sm font-bold border-b-2 border-transparent text-slate-500 hover:text-slate-700 transition-colors" data-tab="submissions" id="tab-subs-btn">
                    <i class="fas fa-table mr-1"></i> Submissions
                </button>
            </div>

            <!-- Body -->
            <div class="flex-1 overflow-y-auto p-6 custom-scrollbar bg-slate-50">
                
                <!-- Tab 1: Settings -->
                <div id="tab-settings" class="space-y-5">
                    <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Form Title *</label>
                                <input type="text" id="form-title" class="w-full px-3 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-anita-500 outline-none" placeholder="Contact Us">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">API Slug *</label>
                                <div class="flex">
                                    <span class="inline-flex items-center px-3 rounded-l-lg border border-r-0 border-slate-200 bg-slate-100 text-slate-500 text-sm">/forms/</span>
                                    <input type="text" id="form-slug" class="flex-1 px-3 py-2 border border-slate-200 rounded-r-lg focus:ring-2 focus:ring-anita-500 outline-none" placeholder="contact">
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Description</label>
                            <textarea id="form-desc" rows="2" class="w-full px-3 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-anita-500 outline-none"></textarea>
                        </div>

                        <!-- Permissions / Tags -->
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-2">API Permissions (Tags)</label>
                            <div class="flex flex-wrap gap-2 p-2 border border-slate-200 rounded-lg bg-slate-50">
                                <div id="tags-list" class="flex flex-wrap gap-2"></div>
                                <input type="text" id="tags-input" placeholder="Add tag (e.g. create, read)..." class="flex-1 bg-transparent min-w-[150px] text-sm outline-none p-1">
                            </div>
                            <div class="mt-2 flex gap-2 text-[10px] text-slate-400 uppercase font-bold">
                                <span>Suggestions:</span>
                                <button onclick="addTag('create')" class="hover:text-anita-600 cursor-pointer">create</button>
                                <button onclick="addTag('read')" class="hover:text-anita-600 cursor-pointer">read</button>
                                <button onclick="addTag('public')" class="hover:text-anita-600 cursor-pointer">public</button>
                            </div>
                            <p class="text-xs text-slate-400 mt-2 italic">
                                <i class="fas fa-info-circle"></i> 'create' allows public POST. 'read' allows public GET. Absence requires Admin login.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Tab 2: Schema Builder -->
                <div id="tab-builder" class="hidden space-y-4">
                    <div class="flex justify-between items-center">
                        <h4 class="font-bold text-slate-700">Form Fields</h4>
                        <button onclick="addField()" class="text-xs font-bold bg-white border border-slate-300 px-3 py-1.5 rounded-lg hover:bg-slate-50 text-slate-600">
                            + Add Field
                        </button>
                    </div>
                    
                    <div id="fields-container" class="space-y-3">
                        <!-- Dynamic Fields Go Here -->
                    </div>

                    <div id="empty-fields-msg" class="text-center py-10 border-2 border-dashed border-slate-200 rounded-xl">
                        <p class="text-slate-400 text-sm">No fields defined yet.</p>
                    </div>
                </div>

                <!-- Tab 3: Submissions -->
                <div id="tab-submissions" class="hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="font-bold text-slate-700">Received Data</h4>
                        <button onclick="fetchSubmissions()" class="text-xs text-anita-600 hover:underline"><i class="fas fa-sync"></i> Refresh</button>
                    </div>
                    <div id="subs-loader" class="hidden text-center py-4"><i class="fas fa-circle-notch fa-spin text-anita-500"></i></div>
                    <div class="overflow-x-auto rounded-lg border border-slate-200 shadow-sm bg-white">
                        <table class="min-w-full text-sm text-left" id="subs-table">
                            <thead class="bg-slate-100 text-slate-600 font-bold uppercase text-xs border-b border-slate-200">
                                <tr>
                                    <th class="px-4 py-3">ID</th>
                                    <th class="px-4 py-3">Date</th>
                                    <th class="px-4 py-3">Preview (Data)</th>
                                    <th class="px-4 py-3 text-right">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="subs-body" class="divide-y divide-slate-100">
                                <!-- Rows -->
                            </tbody>
                        </table>
                        <div id="no-subs-msg" class="text-center py-8 text-slate-400 hidden">No submissions found.</div>
                    </div>
                </div>

            </div>

            <!-- Footer -->
            <div class="px-6 py-4 bg-white border-t border-slate-100 flex justify-end gap-3 rounded-b-2xl">
                <button onclick="closeModal()" class="px-4 py-2 text-sm font-bold text-slate-500 hover:text-slate-700 bg-slate-100 rounded-lg transition">Cancel</button>
                <button onclick="saveForm()" class="px-6 py-2 bg-anita-600 hover:bg-anita-700 text-white text-sm font-bold rounded-lg shadow-lg transition transform hover:-translate-y-0.5">
                    Save Form
                </button>
            </div>
        </div>
    </div>

    <!-- Logic -->
    <script>
        // --- State ---
        let allForms = [];
        let currentTags = [];
        let currentFields = [];
        let isEditing = false;
        let currentSlug = '';

        // --- Init ---
        document.addEventListener('DOMContentLoaded', () => {
            fetchForms();
            setupListeners();
        });

        function setupListeners() {
            // Tabs
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.tab-btn').forEach(b => {
                        b.classList.remove('border-anita-600', 'text-anita-600', 'active');
                        b.classList.add('border-transparent', 'text-slate-500');
                    });
                    e.currentTarget.classList.remove('border-transparent', 'text-slate-500');
                    e.currentTarget.classList.add('border-anita-600', 'text-anita-600', 'active');

                    const t = e.currentTarget.dataset.tab;
                    document.getElementById('tab-settings').classList.toggle('hidden', t !== 'settings');
                    document.getElementById('tab-builder').classList.toggle('hidden', t !== 'builder');
                    document.getElementById('tab-submissions').classList.toggle('hidden', t !== 'submissions');

                    if(t === 'submissions' && isEditing) fetchSubmissions();
                });
            });

            // Slug Auto-gen
            document.getElementById('form-title').addEventListener('input', (e) => {
                if (!isEditing) {
                    document.getElementById('form-slug').value = e.target.value.toLowerCase().replace(/[^\w\s-]/g, '').replace(/\s+/g, '-');
                }
            });

            // Tags
            document.getElementById('tags-input').addEventListener('keydown', (e) => {
                if(e.key === 'Enter') {
                    e.preventDefault();
                    addTag(e.target.value);
                    e.target.value = '';
                }
            });
        }

        // --- API Fetch ---
        async function fetchForms() {
            try {
                const res = await fetch('/forms/list');
                if(res.status === 401) window.location.href = '/auth/login';
                allForms = await res.json();
                renderGrid();
                document.getElementById('forms-loader').classList.add('hidden');
                document.getElementById('forms-container').classList.remove('hidden');
            } catch(e) { console.error(e); }
        }

        // --- Render Grid ---
        function renderGrid() {
            const c = document.getElementById('forms-container');
            c.innerHTML = '';
            
            if(allForms.length === 0) {
                c.innerHTML = `<div class="col-span-3 text-center text-slate-400 py-10">No forms found. Create one!</div>`;
                return;
            }

            allForms.forEach(f => {
                const div = document.createElement('div');
                div.className = 'bg-white p-6 rounded-xl shadow-sm border border-slate-100 hover:shadow-md transition group relative';
                
                // Tags Badge
                const tagsHtml = (f.tags || []).map(t => {
                    let color = 'bg-slate-100 text-slate-500';
                    if(t === 'create') color = 'bg-green-100 text-green-600';
                    if(t === 'read') color = 'bg-blue-100 text-blue-600';
                    if(t === 'admin') color = 'bg-red-100 text-red-600';
                    return `<span class="${color} text-[10px] font-bold px-2 py-0.5 rounded uppercase">${t}</span>`;
                }).join(' ');

                div.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <div class="w-10 h-10 rounded-lg bg-anita-100 text-anita-600 flex items-center justify-center">
                            <i class="fas fa-paper-plane"></i>
                        </div>
                        <div class="flex gap-2 opacity-0 group-hover:opacity-100 transition">
                            <button onclick="openModal('edit', '${f.slug}')" class="text-slate-400 hover:text-anita-600"><i class="fas fa-cog"></i></button>
                            <button onclick="deleteForm('${f.slug}')" class="text-slate-400 hover:text-red-600"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                    <h3 class="font-bold text-lg text-slate-800 mb-1">${f.title}</h3>
                    <p class="text-xs text-slate-400 font-mono mb-3">/forms/${f.slug}</p>
                    <div class="flex flex-wrap gap-1 mb-4 h-6 overflow-hidden">
                        ${tagsHtml}
                    </div>
                    <div class="border-t border-slate-50 pt-3 flex justify-between items-center">
                        <span class="text-xs text-slate-400 font-bold">Schema: ${(f.schema?.fields || []).length} Fields</span>
                        <button onclick="openModal('edit', '${f.slug}')" class="text-xs font-bold text-anita-600 hover:underline">Manage</button>
                    </div>
                `;
                c.appendChild(div);
            });
        }

        // --- Modal Logic ---
        function openModal(mode, slug = null) {
            document.getElementById('form-modal').classList.remove('hidden');
            
            // Reset
            document.getElementById('form-title').value = '';
            document.getElementById('form-slug').value = '';
            document.getElementById('form-desc').value = '';
            currentTags = [];
            currentFields = [];
            renderTags();
            renderFields();
            document.querySelector('[data-tab="settings"]').click(); // Reset tab

            if(mode === 'create') {
                isEditing = false;
                document.getElementById('modal-title').innerText = 'New Form';
                document.getElementById('form-slug').disabled = false;
                document.getElementById('tab-subs-btn').classList.add('hidden'); // No subs for new form
                // Default Field
                addField();
            } else {
                isEditing = true;
                currentSlug = slug;
                document.getElementById('modal-title').innerText = 'Edit Form';
                document.getElementById('form-slug').disabled = true;
                document.getElementById('tab-subs-btn').classList.remove('hidden');

                const f = allForms.find(i => i.slug === slug);
                if(f) {
                    document.getElementById('form-title').value = f.title;
                    document.getElementById('form-slug').value = f.slug;
                    document.getElementById('form-desc').value = f.description || '';
                    currentTags = f.tags || [];
                    // Parse schema
                    if(f.schema && f.schema.fields) {
                        currentFields = f.schema.fields;
                    } else {
                        currentFields = [];
                    }
                    renderTags();
                    renderFields();
                }
            }
        }

        function closeModal() {
            document.getElementById('form-modal').classList.add('hidden');
        }

        // --- Tag Logic ---
        function addTag(t) {
            const val = t.trim();
            if(val && !currentTags.includes(val)) {
                currentTags.push(val);
                renderTags();
            }
        }
        function renderTags() {
            const c = document.getElementById('tags-list');
            c.innerHTML = '';
            currentTags.forEach((t, i) => {
                const s = document.createElement('span');
                s.className = 'bg-white border border-slate-200 text-slate-600 px-2 py-1 rounded text-xs font-bold flex items-center gap-1 shadow-sm';
                s.innerHTML = `${t} <button onclick="currentTags.splice(${i},1); renderTags()" class="hover:text-red-500"><i class="fas fa-times"></i></button>`;
                c.appendChild(s);
            });
        }

        // --- Builder Logic ---
        function addField() {
            currentFields.push({ name: '', label: '', type: 'text', required: false });
            renderFields();
        }

        function renderFields() {
            const c = document.getElementById('fields-container');
            const empty = document.getElementById('empty-fields-msg');
            c.innerHTML = '';
            
            if(currentFields.length === 0) {
                empty.classList.remove('hidden');
            } else {
                empty.classList.add('hidden');
                currentFields.forEach((f, i) => {
                    const row = document.createElement('div');
                    row.className = 'flex gap-2 items-center bg-white p-3 rounded-lg border border-slate-200 shadow-sm animate-slide-in';
                    
                    row.innerHTML = `
                        <div class="flex-shrink-0 w-6 text-center text-slate-300 text-xs font-bold">${i+1}</div>
                        
                        <div class="flex-1 grid grid-cols-12 gap-2">
                            <div class="col-span-4">
                                <input type="text" placeholder="Label (e.g. Email)" value="${f.label}" 
                                    oninput="updateField(${i}, 'label', this.value)"
                                    class="w-full px-2 py-1.5 text-sm border border-slate-200 rounded focus:ring-1 focus:ring-anita-500 outline-none">
                            </div>
                            <div class="col-span-4">
                                <input type="text" placeholder="key_name" value="${f.name}" 
                                    oninput="updateField(${i}, 'name', this.value)"
                                    class="w-full px-2 py-1.5 text-sm border border-slate-200 rounded bg-slate-50 font-mono text-slate-600 focus:ring-1 focus:ring-anita-500 outline-none">
                            </div>
                            <div class="col-span-3">
                                <select onchange="updateField(${i}, 'type', this.value)" class="w-full px-2 py-1.5 text-sm border border-slate-200 rounded bg-white focus:ring-1 focus:ring-anita-500 outline-none">
                                    <option value="text" ${f.type=='text'?'selected':''}>Text</option>
                                    <option value="email" ${f.type=='email'?'selected':''}>Email</option>
                                    <option value="textarea" ${f.type=='textarea'?'selected':''}>Area</option>
                                    <option value="number" ${f.type=='number'?'selected':''}>Num</option>
                                </select>
                            </div>
                            <div class="col-span-1 flex items-center justify-center">
                                <input type="checkbox" ${f.required?'checked':''} onchange="updateField(${i}, 'required', this.checked)" title="Required?">
                            </div>
                        </div>

                        <button onclick="currentFields.splice(${i},1); renderFields()" class="p-2 text-slate-400 hover:text-red-500 transition">
                            <i class="fas fa-trash"></i>
                        </button>
                    `;
                    c.appendChild(row);
                });
            }
        }

        function updateField(index, key, val) {
            currentFields[index][key] = val;
            // Auto-generate name from label if name is empty
            if(key === 'label' && currentFields[index].name === '') {
                currentFields[index].name = val.toLowerCase().replace(/[^a-z0-9_]/g, '_');
                renderFields(); // Re-render to show auto-gen
            }
        }

        // --- Save Logic ---
        async function saveForm() {
            const payload = {
                title: document.getElementById('form-title').value,
                slug: document.getElementById('form-slug').value,
                description: document.getElementById('form-desc').value,
                tags: currentTags,
                schema: { fields: currentFields },
                custom: {}
            };

            if(!payload.title || !payload.slug) { alert('Title/Slug required'); return; }

            const url = isEditing ? `/forms/${currentSlug}` : '/forms/';
            const method = isEditing ? 'PUT' : 'POST';

            try {
                const res = await fetch(url, {
                    method: method,
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(payload)
                });
                if(res.ok) {
                    closeModal();
                    fetchForms();
                } else {
                    alert('Error saving form');
                }
            } catch(e) { alert('Network error'); }
        }

        async function deleteForm(slug) {
            if(!confirm('Delete this form and all its data?')) return;
            await fetch(`/forms/${slug}`, {method: 'DELETE'});
            fetchForms();
        }

        // --- Submissions Logic ---
        async function fetchSubmissions() {
            const loader = document.getElementById('subs-loader');
            const table = document.getElementById('subs-table');
            const body = document.getElementById('subs-body');
            const none = document.getElementById('no-subs-msg');
            
            loader.classList.remove('hidden');
            body.innerHTML = '';
            none.classList.add('hidden');

            try {
                const res = await fetch(`/forms/${currentSlug}/submissions`);
                const data = await res.json();

                if(data.length === 0) {
                    none.classList.remove('hidden');
                } else {
                    data.forEach(sub => {
                        const tr = document.createElement('tr');
                        tr.className = 'hover:bg-slate-50 transition';
                        
                        const date = new Date(sub.created).toLocaleString();
                        // Preview first 2 keys of data
                        const preview = Object.entries(sub.data).slice(0,2).map(([k,v]) => `<b>${k}:</b> ${v}`).join(', ');

                        tr.innerHTML = `
                            <td class="px-4 py-3 font-mono text-xs text-slate-500">#${sub.id}</td>
                            <td class="px-4 py-3 text-slate-600">${date}</td>
                            <td class="px-4 py-3 text-slate-800">${preview}...</td>
                            <td class="px-4 py-3 text-right">
                                <button onclick="deleteSubmission(${sub.id})" class="text-slate-400 hover:text-red-600"><i class="fas fa-trash"></i></button>
                            </td>
                        `;
                        body.appendChild(tr);
                    });
                }
            } catch(e) { console.error(e); }
            finally { loader.classList.add('hidden'); }
        }

        async function deleteSubmission(id) {
            if(!confirm('Delete submission?')) return;
            await fetch(`/forms/${currentSlug}/submissions/${id}`, {method: 'DELETE'});
            fetchSubmissions();
        }

    </script>
</body>
</html>
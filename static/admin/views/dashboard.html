<!-- The Refined Tabbed Dashboard View (Inspired by the new style guide) -->
<div x-data="dashboardManager" class="flex flex-col h-full bg-slate-50 dark:bg-slate-900 text-slate-600 dark:text-slate-300 transition-colors">
    
    <!-- HEADER -->
    <header class="bg-white/80 dark:bg-slate-800/80 backdrop-blur-xl border-b border-slate-200 dark:border-slate-700 h-16 flex items-center justify-between px-8 shadow-sm z-10 flex-shrink-0">
        <div>
            <h1 class="text-xl font-bold text-slate-800 dark:text-slate-100">Dashboard</h1>
            <p class="text-xs text-slate-500 dark:text-slate-400">Welcome to your command center</p>
        </div>
        
        <!-- === LOGOUT BUTTON ADDED HERE === -->
        <div>
            <button @click="logout" 
                    :disabled="isLoggingOut"
                    class="flex items-center justify-center px-4 py-2 rounded-lg text-sm font-semibold transition-colors
                           bg-slate-100 hover:bg-slate-200 text-slate-600
                           dark:bg-slate-700 dark:hover:bg-slate-600 dark:text-slate-300
                           disabled:opacity-60 disabled:cursor-not-allowed">
                <template x-if="!isLoggingOut">
                    <span><i class="fas fa-sign-out-alt mr-2"></i> Logout</span>
                </template>
                <template x-if="isLoggingOut">
                    <span><i class="fas fa-circle-notch fa-spin mr-2"></i> Logging out...</span>
                </template>
            </button>
        </div>
        <!-- === END OF ADDED BUTTON === -->

    </header>

    <!-- CONTENT SCROLL AREA -->
    <div class="flex-1 overflow-y-auto p-6 md:p-8 custom-scrollbar">
        
        <!-- Loader -->
        <div x-show="isLoading" class="flex justify-center items-center h-64">
            <i class="fas fa-circle-notch fa-spin text-4xl text-anita-400"></i>
        </div>

        <!-- Dashboard Content (after loading) -->
        <div x-show="!isLoading" class="animate-fade-in" x-cloak>
            
            <!-- TABS NAVIGATION -->
            <div class="mb-8">
                <div class="border-b border-slate-200 dark:border-slate-700">
                    <nav class="-mb-px flex space-x-6" aria-label="Tabs">
                        <button @click="activeTab = 'welcome'" 
                                :class="activeTab === 'welcome' ? 'border-anita-500 text-anita-600 dark:text-anita-400 font-semibold' : 'border-transparent text-slate-500 hover:text-slate-700 hover:border-slate-300 dark:hover:text-slate-200 dark:hover:border-slate-600'"
                                class="whitespace-nowrap flex items-center py-4 px-1 border-b-2 font-medium text-sm transition-all">
                            <i class="fas fa-star mr-2"></i> Welcome
                        </button>
                        <button @click="activeTab = 'stats'" 
                                :class="activeTab === 'stats' ? 'border-anita-500 text-anita-600 dark:text-anita-400 font-semibold' : 'border-transparent text-slate-500 hover:text-slate-700 hover:border-slate-300 dark:hover:text-slate-200 dark:hover:border-slate-600'"
                                class="whitespace-nowrap flex items-center py-4 px-1 border-b-2 font-medium text-sm transition-all">
                            <i class="fas fa-chart-bar mr-2"></i> Stats & Activity
                        </button>
                        <button @click="activeTab = 'settings'" 
                                :class="activeTab === 'settings' ? 'border-anita-500 text-anita-600 dark:text-anita-400 font-semibold' : 'border-transparent text-slate-500 hover:text-slate-700 hover:border-slate-300 dark:hover:text-slate-200 dark:hover:border-slate-600'"
                                class="whitespace-nowrap flex items-center py-4 px-1 border-b-2 font-medium text-sm transition-all">
                            <i class="fas fa-cog mr-2"></i> Profile & Settings
                        </button>
                    </nav>
                </div>
            </div>

            <!-- TAB CONTENT -->
            <div>
                <!-- ===== WELCOME TAB ===== -->
                <div x-show="activeTab === 'welcome'" class="animate-fade-in grid lg:grid-cols-2 gap-8 items-center">
                    
                    <!-- Left Column: Welcome Message & Image (Inspired by your example) -->
                    <div class="text-center">
                        <div class="relative inline-block" style="animation: float 4s ease-in-out infinite;">
                            <div class="absolute inset-0 bg-anita-200 dark:bg-anita-500/30 rounded-2xl blur-xl opacity-50 transform translate-y-4"></div>
                            <img src="/media/anita.webp" alt="Anita Mascot" class="relative z-10 w-72 aspect-[4/3] object-cover rounded-2xl border-4 border-white dark:border-slate-700 shadow-lg mx-auto">
                        </div>
                        <h1 class="mt-8 text-3xl font-extrabold text-slate-900 dark:text-slate-100">Welcome Back!</h1>
                        <p class="mt-2 text-slate-600 dark:text-slate-400 leading-relaxed">
                            Here's a quick look at your dashboard.
                        </p>
                    </div>
                    
                    <!-- Right Column: User Profile Card -->
                    <div class="bg-white dark:bg-slate-800 p-8 rounded-2xl shadow-lg border border-slate-100 dark:border-slate-700">
                        <div class="flex flex-col sm:flex-row items-center gap-6 text-center sm:text-left">
                            <!-- PFP -->
                            <div class="relative flex-shrink-0">
                                <template x-if="user.pfp_url"><img :src="user.pfp_url" alt="Profile" class="w-24 h-24 rounded-full object-cover border-4 border-white dark:border-slate-700 shadow-md"></template>
                                <template x-if="!user.pfp_url"><div class="w-24 h-24 rounded-full bg-slate-200 text-slate-500 flex items-center justify-center text-4xl border-4 border-white dark:border-slate-700 shadow-md"><i class="fas fa-user"></i></div></template>
                            </div>
                            <!-- User Info -->
                            <div>
                                <h2 class="text-2xl font-extrabold text-slate-800 dark:text-slate-100" x-text="user.display_name || user.username"></h2>
                                <span class="bg-anita-100 text-anita-700 dark:bg-anita-500/20 dark:text-anita-300 text-xs font-bold px-3 py-1 rounded-full border border-anita-200 dark:border-anita-500/30 mt-2 inline-block" x-text="user.role"></span>
                                <p class="text-sm mt-3 text-slate-500 dark:text-slate-400 italic">
                                    <template x-if="user.custom && user.custom.about_me"><span x-text="user.custom.about_me"></span></template>
                                    <template x-if="!user.custom || !user.custom.about_me">You haven't set an "About Me" yet. Add one in the settings tab!</template>
                                </p>
                            </div>
                        </div>
                        <button @click="activeTab = 'settings'" class="group mt-6 w-full flex items-center justify-center bg-slate-900 hover:bg-slate-700 dark:bg-anita-600 dark:hover:bg-anita-500 text-white px-4 py-2.5 rounded-lg shadow-lg hover:shadow-xl transition-all transform hover:-translate-y-0.5 font-bold text-sm">
                            <i class="fas fa-user-edit mr-2"></i> Edit Your Profile
                        </button>
                    </div>
                </div>

                <!-- ===== STATS & ACTIVITY TAB ===== -->
                <div x-show="activeTab === 'stats'" class="animate-fade-in space-y-8">
                    <!-- Stats Grid -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-5">
                        <div class="bg-white dark:bg-slate-800 p-4 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 flex items-start gap-4">
                            <div class="w-10 h-10 rounded-lg bg-blue-100 text-blue-600 flex items-center justify-center text-lg flex-shrink-0"><i class="fas fa-file-alt"></i></div>
                            <div><p class="text-2xl font-extrabold text-slate-800 dark:text-slate-100" x-text="stats.core_counts.pages"></p><p class="text-xs font-medium text-slate-500 dark:text-slate-400">Total Pages</p></div>
                        </div>
                        <div class="bg-white dark:bg-slate-800 p-4 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 flex items-start gap-4">
                            <div class="w-10 h-10 rounded-lg bg-purple-100 text-purple-600 flex items-center justify-center text-lg flex-shrink-0"><i class="fas fa-clipboard-list"></i></div>
                            <div><p class="text-2xl font-extrabold text-slate-800 dark:text-slate-100" x-text="stats.core_counts.collections"></p><p class="text-xs font-medium text-slate-500 dark:text-slate-400">Collections</p></div>
                        </div>
                        <div class="bg-white dark:bg-slate-800 p-4 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 flex items-start gap-4">
                            <div class="w-10 h-10 rounded-lg bg-green-100 text-green-600 flex items-center justify-center text-lg flex-shrink-0"><i class="fas fa-inbox"></i></div>
                            <div><p class="text-2xl font-extrabold text-slate-800 dark:text-slate-100" x-text="stats.core_counts.submissions"></p><p class="text-xs font-medium text-slate-500 dark:text-slate-400">Submissions</p></div>
                        </div>
                        <div class="bg-white dark:bg-slate-800 p-4 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 flex items-start gap-4">
                            <div class="w-10 h-10 rounded-lg bg-pink-100 text-pink-600 flex items-center justify-center text-lg flex-shrink-0"><i class="fas fa-feather-alt"></i></div>
                            <div><p class="text-2xl font-extrabold text-slate-800 dark:text-slate-100" x-text="stats.page_stats.blog_posts_count"></p><p class="text-xs font-medium text-slate-500 dark:text-slate-400">Blog Posts</p></div>
                        </div>
                        <div class="bg-white dark:bg-slate-800 p-4 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 flex items-start gap-4">
                            <div class="w-10 h-10 rounded-lg bg-orange-100 text-orange-600 flex items-center justify-center text-lg flex-shrink-0"><i class="fas fa-users"></i></div>
                            <div><p class="text-2xl font-extrabold text-slate-800 dark:text-slate-100" x-text="stats.core_counts.users"></p><p class="text-xs font-medium text-slate-500 dark:text-slate-400">Users</p></div>
                        </div>
                    </div>
                    <!-- Activity & Recents Grid -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="bg-white dark:bg-slate-800 p-5 rounded-xl shadow-lg border border-slate-100 dark:border-slate-700"><h3 class="font-bold text-slate-800 dark:text-slate-100 mb-4">Recently Created Pages</h3><div class="space-y-3"><template x-for="page in stats.recent_items.newest_pages" :key="page.slug"><div class="flex items-center gap-3"><div class="w-8 h-8 rounded-md flex items-center justify-center text-xs flex-shrink-0" :class="page.type === 'markdown' ? 'bg-purple-100 text-purple-600' : 'bg-pink-100 text-pink-600'"><i class="fas" :class="page.type === 'markdown' ? 'fa-pen-nib' : 'fa-code'"></i></div><div><p class="text-sm font-bold text-slate-700 dark:text-slate-200 leading-tight" x-text="page.title"></p><p class="text-xs text-slate-400" x-text="formatDate(page.created)"></p></div></div></template><div x-show="stats.recent_items.newest_pages.length === 0" class="text-center text-xs text-slate-400 italic py-4">No recent pages to show.</div></div></div>
                        <div class="space-y-6"><div class="bg-white dark:bg-slate-800 p-5 rounded-xl shadow-lg border border-slate-100 dark:border-slate-700"><h3 class="font-bold text-slate-800 dark:text-slate-100 mb-4">Most Active Collections</h3><div class="space-y-2"><template x-for="collection in stats.activity.top_collections_by_submission" :key="collection.slug"><div class="flex justify-between items-center text-sm"><p class="font-mono text-slate-600 dark:text-slate-300" x-text="collection.slug"></p><p class="font-bold text-slate-800 bg-slate-100 dark:text-slate-200 dark:bg-slate-700 px-2 py-0.5 rounded-full text-xs" x-text="collection.count"></p></div></template><div x-show="stats.activity.top_collections_by_submission.length === 0" class="text-center text-xs text-slate-400 italic py-4">No collection activity yet.</div></div></div><div class="bg-white dark:bg-slate-800 p-5 rounded-xl shadow-lg border border-slate-100 dark:border-slate-700"><h3 class="font-bold text-slate-800 dark:text-slate-100 mb-4">Popular Labels</h3><div class="flex flex-wrap gap-2"><template x-for="label in stats.activity.top_labels_on_pages" :key="label.name"><div class="bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 text-xs font-bold px-2 py-1 rounded-md border border-slate-200 dark:border-slate-600" x-text="label.name"></div></template><div x-show="stats.activity.top_labels_on_pages.length === 0" class="text-center text-xs text-slate-400 italic py-4 w-full">No labels are in use.</div></div></div></div>
                        <div class="bg-white dark:bg-slate-800 p-5 rounded-xl shadow-lg border border-slate-100 dark:border-slate-700"><h3 class="font-bold text-slate-800 dark:text-slate-100 mb-4">Latest Submissions</h3><div class="space-y-3"><template x-for="submission in stats.recent_items.latest_submissions" :key="submission.id"><div class="flex items-center gap-3"><div class="w-8 h-8 rounded-md flex items-center justify-center text-xs flex-shrink-0 bg-green-100 text-green-600"><i class="fas fa-inbox"></i></div><div><p class="text-sm font-bold text-slate-700 dark:text-slate-200 leading-tight">New submission for <span class="font-mono" x-text="submission.collection_slug"></span></p><p class="text-xs text-slate-400" x-text="formatDate(submission.created)"></p></div></div></template><div x-show="stats.recent_items.latest_submissions.length === 0" class="text-center text-xs text-slate-400 italic py-4">No recent submissions.</div></div></div>
                    </div>
                </div>

                <!-- ===== PROFILE & SETTINGS TAB ===== -->
                <div x-show="activeTab === 'settings'" class="animate-fade-in bg-white dark:bg-slate-800 p-8 rounded-2xl shadow-xl border border-slate-100 dark:border-slate-700">
                    <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-xl border border-slate-100 dark:border-slate-700">
                        <div class="p-6 md:p-8 border-b border-slate-200 dark:border-slate-700">
                            <h2 class="text-xl font-bold text-slate-800 dark:text-slate-100">Profile Information</h2>
                            <p class="text-sm text-slate-500 dark:text-slate-400 mt-1">Update your display name, avatar, and personal details.</p>
                        </div>
                        
                        <div class="p-6 md:p-8 grid grid-cols-1 md:grid-cols-3 gap-8">
                            <!-- Left Side: Collection Fields -->
                            <div class="md:col-span-2 space-y-5">
                                <div>
                                    <label class="block text-xs font-bold text-slate-500 dark:text-slate-400 uppercase mb-1">Display Name</label>
                                    <input type="text" x-model="profileCollection.display_name" class="w-full px-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-anita-500 outline-none font-bold bg-white dark:bg-slate-900/50 text-slate-800 dark:text-slate-100">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-slate-500 dark:text-slate-400 uppercase mb-1">About Me</label>
                                    <textarea x-model="profileCollection.custom.about_me" rows="4" placeholder="Tell us a little about yourself..." class="w-full px-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-anita-500 outline-none text-sm bg-white dark:bg-slate-900/50"></textarea>
                                </div>
                            </div>
                            
                            <!-- Right Side: REFINED Profile Picture Uploader -->
                            <div class="space-y-3 text-center">
                                <label class="block text-xs font-bold text-slate-500 dark:text-slate-400 uppercase">Profile Picture</label>
                                
                                <!-- Visually hidden file input -->
                                <input type="file" id="pfp-upload" class="hidden" @change="handlePfpSelection" accept="image/png, image/jpeg, image/gif, image/webp">
                                
                                <!-- Uploader UI -->
                                <label for="pfp-upload" class="group relative w-32 h-32 mx-auto cursor-pointer">
                                    <!-- The Image/Avatar -->
                                    <template x-if="pfpPreviewUrl || profileCollection.pfp_url">
                                        <img :src="pfpPreviewUrl || profileCollection.pfp_url" alt="Profile" class="w-32 h-32 rounded-full object-cover mx-auto shadow-md transition-all group-hover:brightness-75">
                                    </template>
                                    <template x-if="!pfpPreviewUrl && !profileCollection.pfp_url">
                                        <div class="w-32 h-32 mx-auto rounded-full bg-slate-200 dark:bg-slate-700 text-slate-500 dark:text-slate-400 flex items-center justify-center text-5xl shadow-md transition-all group-hover:brightness-75"><i class="fas fa-user"></i></div>
                                    </template>
                                    
                                    <!-- Hover Overlay (Upload Prompt) -->
                                    <div x-show="!isUploadingPfp" class="absolute inset-0 bg-black/50 rounded-full flex flex-col items-center justify-center text-white opacity-0 group-hover:opacity-100 transition-opacity">
                                        <i class="fas fa-camera text-2xl"></i>
                                        <span class="text-xs font-bold mt-1">Change</span>
                                    </div>

                                    <!-- Uploading Spinner Overlay -->
                                    <div x-show="isUploadingPfp" x-transition class="absolute inset-0 bg-black/60 rounded-full flex items-center justify-center text-white">
                                        <i class="fas fa-circle-notch fa-spin text-3xl"></i>
                                    </div>
                                </label>
                                
                                <p class="text-xs text-slate-400">Click image to upload.<br>Max 2MB.</p>
                            </div>
                        </div>
                    </div>
                    <!-- Save Button -->
                    <div class="mt-8 pt-6 border-t border-slate-200 dark:border-slate-700 flex justify-end">
                        <button @click="saveProfile" class="px-6 py-2 bg-slate-900 hover:bg-slate-700 dark:bg-anita-600 dark:hover:bg-anita-500 text-white text-sm font-bold rounded-lg shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all">Save Changes</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
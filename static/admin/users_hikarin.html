<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anita Admin | Users & Roles</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">

    <!-- Dependencies -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>
    <script src="/static/hikarin/hikarin.js"></script>

    <!-- Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Nunito', 'sans-serif'] },
                    colors: {
                        anita: {
                            50: '#f0f9ff', 100: '#e0f2fe', 200: '#bae6fd', 300: '#7dd3fc',
                            400: '#38bdf8', 500: '#0ea5e9', 600: '#0284c7', 700: '#0369a1',
                        }
                    },
                    animation: { 'float': 'float 0.3s ease-out' },
                    keyframes: {
                        float: { '0%': { opacity: '0', transform: 'translateY(10px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } }
                    }
                }
            }
        }
    </script>
    <style>
        [x-cloak] { display: none !important; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .discord-sidebar-item { @apply flex items-center px-2 py-1.5 rounded text-sm font-medium cursor-pointer transition-colors; }
        .discord-sidebar-item.active { @apply bg-slate-200 text-slate-900; }
        .discord-sidebar-item:not(.active) { @apply text-slate-500 hover:bg-slate-100 hover:text-slate-700; }
        
        /* Toggle Switch */
        .toggle-checkbox:checked { right: 0; border-color: #10b981; }
        .toggle-checkbox:checked + .toggle-label { background-color: #10b981; }
    </style>
</head>

<body class="bg-slate-100 text-slate-800 font-sans h-screen overflow-hidden flex"
    x-data="{
        // Data
        users: [],
        roles: [],
        view: 'users',
        
        // Selection
        selectedRole: null,
        
        // Modals
        userModalOpen: false,
        passwordModalOpen: false,
        deleteModalOpen: false,
        
        // Forms
        userForm: { username: '', display_name: '', role: 'viewer', disabled: false, password: '' },
        passwordForm: { username: '', new_password: '' },
        roleForm: { role_name: '', permissions: [] },
        
        deleteTarget: { type: '', id: '' },
        isEditingUser: false,

        // Permissions Metadata
        permCategories: [
            {
                name: 'Administrator',
                perms: [
                    { key: '*', label: 'Administrator', desc: 'Grants full unrestricted access to all system features, settings, content, and tools.' }

                ]
            },
            {
                name: 'Forms & Submissions',
                perms: [
                    { key: 'form:create', label: 'Create Forms', desc: 'Allows creating new forms, including defining fields, settings, and behavior.' },
{ key: 'form:read', label: 'View Forms', desc: 'Allows viewing existing forms and their configuration.' },
{ key: 'form:update', label: 'Edit Forms', desc: 'Allows editing or modifying existing forms and their settings.' },
{ key: 'form:delete', label: 'Delete Forms', desc: 'Allows deleting forms entirely from the system.' },

{ key: 'submission:create', label: 'Create Submissions (Override)', desc: 'Allows creating form submissions even when the form’s own access rules would normally prevent it.' },
{ key: 'submission:read', label: 'View Submissions (Override)', desc: 'Allows viewing any form submissions regardless of the form’s internal permission rules.' },
{ key: 'submission:update', label: 'Edit Submissions (Override)', desc: 'Allows editing any form submission even if role-based or form-level rules would normally block it.' },
{ key: 'submission:delete', label: 'Delete Submissions (Override)', desc: 'Allows deleting any form submission regardless of the form’s access restrictions.' },

                ]
            },
            {
                name: 'Media Library',
                perms: [
                    { key: 'media:create', label: 'Upload Media', desc: 'Allows uploading new media files into the media library.' },
{ key: 'media:read', label: 'View Media Library', desc: 'Allows browsing and viewing items in the media library.' },
{ key: 'media:update', label: 'Edit Media Metadata', desc: 'Allows editing media details such as titles, descriptions, and tags.' },
{ key: 'media:delete', label: 'Delete Media', desc: 'Allows permanently deleting media files from the library.' },

                ]
            },
            {
                name: 'Blog System',
                perms: [
                  { key: 'blog:create', label: 'Create Posts', desc: 'Allows writing and publishing new blog posts.' },
{ key: 'blog:read', label: 'Read Posts', desc: 'Allows access to view all blog posts in the system.' },
{ key: 'blog:update', label: 'Edit Posts', desc: 'Allows modifying existing blog posts.' },
{ key: 'blog:delete', label: 'Delete Posts', desc: 'Allows deleting blog posts permanently.' },

                ]
            },
            {
                name: 'Pages & Content',
                perms: [
                    { key: 'page:create', label: 'Create Pages', desc: 'Allows creating new pages in the CMS.' },
{ key: 'page:read', label: 'View Pages', desc: 'Allows viewing all pages within the CMS.' },
{ key: 'page:update', label: 'Edit Pages', desc: 'Allows modifying page content, metadata, and settings.' },
{ key: 'page:delete', label: 'Delete Pages', desc: 'Allows deleting pages from the CMS.' },

                ]
            },
            {
                name: 'System & AI',
                perms: [
                  { key: 'config:read', label: 'View Config', desc: 'Allows viewing system configuration values without exposing sensitive secrets.' },
{ key: 'config:update', label: 'Edit Config', desc: 'Allows editing or updating system configuration values.' },

{ key: 'aina', label: 'Access Aina (HTML AI)', desc: 'Allows using Aina, the HTML-based AI assistant.' },
{ key: 'asta', label: 'Access Asta (Markdown AI)', desc: 'Allows using Asta, the Markdown Editor.' },

                ]
            }
        ],

        async init() {
            this.fetchData();
        },

        async fetchData() {
            try {
                const uReq = $api.users.list();
                const rReq = $api.users.roles().list();
                
                await Promise.all([uReq.execute(), rReq.execute()]);
                
                if(uReq.isSuccess) this.users = uReq.data;
                
                if(rReq.isSuccess) {
                    // Safety check if backend still returns Dict
                    if (rReq.data && !Array.isArray(rReq.data) && typeof rReq.data === 'object') {
                         this.roles = Object.entries(rReq.data).map(([k, v]) => ({ role_name: k, permissions: v }));
                    } else {
                         this.roles = rReq.data;
                    }
                    
                    // Auto-select logic
                    if(this.view === 'roles' && !this.selectedRole && this.roles.length > 0) {
                        this.selectRole(this.roles[0]);
                    }
                }
            } catch(e) { console.error(e); }
        },

        openCreateUser() {
            this.isEditingUser = false;
            // Defaults
            this.userForm = { username: '', display_name: '', role: 'viewer', disabled: false, password: '' };
            if(this.roles.length > 0) this.userForm.role = this.roles[0].role_name;
            this.userModalOpen = true;
        },

        openEditUser(user) {
            this.isEditingUser = true;
            this.userForm = { ...user };
            this.userModalOpen = true;
        },

        openPasswordModal(user) {
            this.passwordForm = { username: user.username, new_password: '' };
            this.passwordModalOpen = true;
        },

        async saveUser() {
            try {
                if (this.isEditingUser) {
                    await $api.users.update().execute(this.userForm.username, {
                        display_name: this.userForm.display_name,
                        role: this.userForm.role,
                        disabled: this.userForm.disabled
                    });
                } else {
                    const formData = new FormData();
                    formData.append('username', this.userForm.username);
                    formData.append('password', this.userForm.password);
                    formData.append('confirm_password', this.userForm.password);
                    if(this.userForm.display_name) formData.append('display_name', this.userForm.display_name);
                    
                    // Create User
                    await $api.users.create().execute(this.userForm);
                    
                    // Role assignment usually happens after create if create endpoint doesn't support it directly
                    // But we'll assume the Update endpoint can set it immediately if Create didn't
                    if(this.userForm.role !== 'viewer') {
                        await $api.users.update().execute(this.userForm.username, { role: this.userForm.role });
                    }
                }
                this.userModalOpen = false;
                this.fetchData();
            } catch(e) { alert('Operation failed: ' + (e.detail || e.message)); }
        },

        async changePassword() {
            try {
                await $api.users.changePassword().execute(this.passwordForm.username, this.passwordForm.new_password);
                this.passwordModalOpen = false;
                alert('Password updated');
            } catch(e) { alert('Failed'); }
        },

        // Role Logic
        selectRole(role) {
            this.selectedRole = role;
            this.roleForm = {
                role_name: role.role_name,
                permissions: [...role.permissions]
            };
        },

        createNewRole() {
            const name = 'New Role ' + (this.roles.length + 1);
            const newRole = { role_name: name, permissions: [] };
            this.roles.push(newRole);
            this.selectRole(newRole);
        },

        togglePermission(key) {
            if (this.roleForm.permissions.includes(key)) {
                this.roleForm.permissions = this.roleForm.permissions.filter(p => p !== key);
            } else {
                this.roleForm.permissions.push(key);
            }
        },

        async saveRole() {
            if(!this.selectedRole) return;
            try {
                // Determine if renaming (Delete Old + Create New) or just Updating
                // For simplicity, just Save. Backend should handle upsert based on role_name.
                await $api.users.roles().save().execute(this.roleForm.role_name, this.roleForm.permissions);
                alert('Role Saved');
                this.fetchData();
            } catch(e) { alert('Save failed'); }
        },

        confirmDelete(type, id) {
            this.deleteTarget = { type, id };
            this.deleteModalOpen = true;
        },

        async doDelete() {
            try {
                if (this.deleteTarget.type === 'user') {
                    await $api.users.delete().execute(this.deleteTarget.id);
                } else {
                    await $api.users.roles().delete().execute(this.deleteTarget.id);
                    if(this.selectedRole && this.selectedRole.role_name === this.deleteTarget.id) {
                        this.selectedRole = null;
                    }
                }
                this.deleteModalOpen = false;
                this.fetchData();
            } catch(e) { alert('Delete failed'); }
        }
    }"
>

    <!-- LEFT SIDEBAR -->
    <aside class="w-64 bg-slate-900 text-white flex flex-col flex-shrink-0 z-20">
        <div class="h-16 flex items-center px-6 border-b border-slate-800 bg-slate-950">
            <img src="/media/anita.jpg" class="h-8 w-8 rounded-full border border-anita-500 mr-3" alt="Logo">
            <span class="font-bold text-lg tracking-wide">Anita CMS</span>
        </div>
        <nav class="flex-1 overflow-y-auto py-4 space-y-1 px-3">
            <a href="/admin/page/" class="flex items-center px-3 py-2.5 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors group">
                <i class="fas fa-layer-group w-6 text-center text-lg group-hover:text-anita-400"></i>
                <span class="ml-3 font-medium">Pages</span>
            </a>
            <a href="/admin/forms/" class="flex items-center px-3 py-2.5 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors group">
                <i class="fas fa-inbox w-6 text-center text-lg group-hover:text-anita-400"></i>
                <span class="ml-3 font-medium">Forms</span>
            </a>
            <a href="/admin/media/" class="flex items-center px-3 py-2.5 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors group">
                <i class="fas fa-images w-6 text-center text-lg group-hover:text-purple-400"></i>
                <span class="ml-3 font-medium">Images</span>
            </a>
            <a href="/admin/files/" class="flex items-center px-3 py-2.5 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors">
                <i class="fas fa-folder-open w-6 text-center text-lg"></i>
                <span class="ml-3 font-medium">Files</span>
            </a>
            <div class="pt-4 pb-2"><p class="px-3 text-xs font-bold text-slate-500 uppercase tracking-wider">System</p></div>
            <a href="/admin/config/" class="flex items-center px-3 py-2.5 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors group">
                <i class="fas fa-robot w-6 text-center text-lg group-hover:text-gray-300"></i>
                <span class="ml-3 font-medium">AI Config</span>
            </a>
            <a href="/admin/users/" class="flex items-center px-3 py-2.5 bg-anita-600 text-white rounded-lg shadow-lg shadow-anita-900/20 transition-colors group">
                <i class="fas fa-users-cog w-6 text-center text-lg"></i>
                <span class="ml-3 font-semibold">Users & Roles</span>
            </a>
        </nav>
    </aside>

    <!-- MAIN CONTENT -->
<!-- Preserving your existing x-data scope (removed the x-data attribute here so it uses yours) -->
<main class="flex-1 flex flex-col h-screen overflow-hidden bg-slate-50">

    <!-- HEADER & TABS -->
    <!-- Replaced the top header and sidebar nav with this Tab bar -->
    <header class="bg-white border-b border-slate-200 flex flex-col shrink-0 z-20 shadow-sm">
        <!-- Top Title Bar -->
        <div class="h-16 flex items-center justify-between px-8">
            <h1 class="text-xl font-bold text-slate-800">System Management</h1>
            
            <!-- Global Actions -->
            <div>
                <!-- Shows "Add Member" only when on Users tab -->
                <button x-show="view === 'users'" @click="openCreateUser" class="bg-anita-600 hover:bg-anita-700 text-white px-4 py-2 rounded-md text-sm font-bold transition shadow-sm flex items-center gap-2">
                    <i class="fas fa-plus text-xs"></i> <span>Add Member</span>
                </button>
                
                <!-- Shows "Add Role" only when on Roles tab -->
                <button x-show="view === 'roles'" @click="createNewRole" class="bg-anita-600 hover:bg-anita-700 text-white px-4 py-2 rounded-md text-sm font-bold transition shadow-sm flex items-center gap-2">
                    <i class="fas fa-plus text-xs"></i> <span>Create Role</span>
                </button>
            </div>
        </div>

        <!-- Navigation Tabs (Replaces Sidebar) -->
        <div class="px-8 flex items-center gap-8 -mb-px">
            <button @click="view = 'users'" 
                :class="view === 'users' ? 'border-anita-600 text-anita-600' : 'border-transparent text-slate-500 hover:text-slate-700 hover:border-slate-300'"
                class="pb-3 border-b-2 text-sm font-bold transition-colors flex items-center gap-2">
                <i class="fas fa-users"></i> Users
            </button>
            <button @click="view = 'roles'; if(!selectedRole && roles.length > 0) selectRole(roles[0])" 
                :class="view === 'roles' ? 'border-anita-600 text-anita-600' : 'border-transparent text-slate-500 hover:text-slate-700 hover:border-slate-300'"
                class="pb-3 border-b-2 text-sm font-bold transition-colors flex items-center gap-2">
                <i class="fas fa-shield-alt"></i> Roles & Permissions
            </button>
        </div>
    </header>

    <!-- CONTENT BODY -->
    <div class="flex-1 overflow-hidden p-6 relative">
        
        <!-- ==================== USERS VIEW ==================== -->
        <div x-show="view === 'users'" class="h-full flex flex-col max-w-6xl mx-auto" x-cloak>
            <div class="bg-white rounded-lg shadow-sm border border-slate-200 flex-1 flex flex-col overflow-hidden">
                <div class="flex-1 overflow-y-auto">
                    <table class="w-full text-left border-collapse">
                        <thead class="bg-slate-50 sticky top-0 z-10 shadow-sm">
                            <tr class="text-xs font-bold text-slate-400 uppercase tracking-wider">
                                <th class="py-3 px-6 pl-8">User</th>
                                <th class="py-3 px-6">Role</th>
                                <th class="py-3 px-6 text-right pr-8">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-100">
                            <template x-for="user in users" :key="user.username">
                                <tr class="group hover:bg-slate-50/80 transition-colors">
                                    <td class="py-3 px-6 pl-8">
                                        <div class="flex items-center">
                                            <div class="w-10 h-10 rounded-full bg-slate-200 flex items-center justify-center text-slate-500 mr-3 overflow-hidden">
                                                <template x-if="user.pfp_url"><img :src="user.pfp_url" class="w-full h-full object-cover"></template>
                                                <template x-if="!user.pfp_url"><i class="fas fa-user"></i></template>
                                            </div>
                                            <div>
                                                <div class="font-bold text-slate-800" x-text="user.display_name || user.username"></div>
                                                <div class="text-xs text-slate-400 font-mono" x-text="'@' + user.username"></div>
                                            </div>
                                            <span x-show="user.disabled" class="ml-2 px-1.5 py-0.5 rounded text-[10px] font-bold bg-red-100 text-red-600 uppercase">Disabled</span>
                                        </div>
                                    </td>
                                    <td class="py-3 px-6">
                                        <span class="inline-flex items-center px-2 py-1 rounded text-xs font-bold bg-slate-100 text-slate-600 border border-slate-200">
                                            <span class="w-2 h-2 rounded-full bg-anita-500 mr-1.5"></span>
                                            <span x-text="user.role"></span>
                                        </span>
                                    </td>
                                    <td class="py-3 px-6 text-right pr-8">
                                        <div class="flex items-center justify-end gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                                            <button @click="openEditUser(user)" class="w-8 h-8 flex items-center justify-center rounded bg-slate-100 hover:bg-white hover:shadow-sm border border-transparent hover:border-slate-200 text-slate-600 transition"><i class="fas fa-pen text-xs"></i></button>
                                            <button @click="openPasswordModal(user)" class="w-8 h-8 flex items-center justify-center rounded bg-slate-100 hover:bg-white hover:shadow-sm border border-transparent hover:border-slate-200 text-slate-600 transition"><i class="fas fa-key text-xs"></i></button>
                                            <button @click="confirmDelete('user', user.username)" class="w-8 h-8 flex items-center justify-center rounded bg-red-50 hover:bg-red-100 text-red-600 transition"><i class="fas fa-trash text-xs"></i></button>
                                        </div>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ==================== ROLES VIEW ==================== -->
        <div x-show="view === 'roles'" class="h-full flex gap-6 max-w-7xl mx-auto" x-cloak>
            
            <!-- Left: Roles List Sidebar -->
            <div class="w-64 flex flex-col">
                <div class="bg-white rounded-lg shadow-sm border border-slate-200 overflow-hidden flex flex-col h-full">
                    <div class="p-3 border-b border-slate-100 bg-slate-50/50">
                        <span class="text-xs font-bold text-slate-400 uppercase">Roles</span>
                    </div>
                    <div class="flex-1 overflow-y-auto p-2 space-y-1">
                        <template x-for="role in roles" :key="role.role_name">
                            <div @click="selectRole(role)" 
                                 :class="selectedRole && selectedRole.role_name === role.role_name ? 'bg-anita-50 border-anita-200 text-anita-700' : 'border-transparent text-slate-500 hover:bg-slate-50 hover:text-slate-700'"
                                 class="px-3 py-2 rounded border cursor-pointer text-sm font-medium flex items-center justify-between group transition-all">
                                <div class="flex items-center gap-2 truncate">
                                    <div class="w-2 h-2 rounded-full bg-slate-300" :class="selectedRole && selectedRole.role_name === role.role_name ? 'bg-anita-500' : ''"></div>
                                    <span x-text="role.role_name"></span>
                                </div>
                                <button @click.stop="confirmDelete('role', role.role_name)" class="text-xs text-red-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition"><i class="fas fa-times"></i></button>
                            </div>
                        </template>
                    </div>
                </div>
            </div>

            <!-- Right: Role Editor -->
            <div class="flex-1 flex flex-col h-full">
                <!-- Editor Container -->
                <div x-show="selectedRole" class="bg-white rounded-lg shadow-sm border border-slate-200 flex flex-col h-full relative overflow-hidden">
                    
                    <!-- Editor Header -->
                    <div class="h-16 border-b border-slate-100 flex items-center justify-between px-8 bg-white z-10">
                        <div class="flex-1 mr-4">
                            <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1">Role Name</label>
                            <input type="text" x-model="roleForm.role_name" class="w-full max-w-sm px-0 py-0 text-lg font-bold text-slate-800 border-none focus:ring-0 placeholder-slate-300" placeholder="Enter Role Name">
                        </div>
                        <button @click="saveRole" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded shadow-sm font-bold text-sm transition">
                            <i class="fas fa-check mr-2"></i>Save Changes
                        </button>
                    </div>
                    
                    <!-- Permissions Scroll Area -->
                    <div class="flex-1 overflow-y-auto p-8 bg-slate-50/50">
                        <template x-for="cat in permCategories" :key="cat.name">
                            <div class="mb-8 bg-white p-6 rounded-lg border border-slate-200 shadow-sm">
                                <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-4 border-b border-slate-100 pb-2" x-text="cat.name"></h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4">
                                    <template x-for="perm in cat.perms" :key="perm.key">
                                        <div class="flex items-center justify-between py-1">
                                            <div class="mr-4">
                                                <div class="text-sm font-bold text-slate-700" x-text="perm.label"></div>
                                                <div class="text-xs text-slate-400" x-text="perm.desc"></div>
                                            </div>
                                            <!-- Toggle Switch -->
                                            <div class="relative inline-block w-12 align-middle select-none">
                                                <input type="checkbox" :id="perm.key" 
                                                       class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer border-slate-200 transition-all duration-300 checked:right-0 checked:border-anita-500" 
                                                       style="right: calc(100% - 1.5rem);"
                                                       :checked="roleForm.permissions.includes(perm.key)"
                                                       @change="togglePermission(perm.key)"/>
                                                <label :for="perm.key" class="toggle-label block overflow-hidden h-6 rounded-full bg-slate-200 cursor-pointer transition-colors duration-300"
                                                       :class="roleForm.permissions.includes(perm.key) ? '!bg-anita-500' : ''"></label>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Empty State -->
                <div x-show="!selectedRole" class="flex-1 bg-white rounded-lg shadow-sm border border-slate-200 flex items-center justify-center text-slate-400">
                    <p>Select a role to edit permissions</p>
                </div>
            </div>
        </div>
    </div>
</main>
    <!-- Modals (User, Password, Delete) -->
    <div x-show="userModalOpen" class="fixed inset-0 z-50 flex items-center justify-center" x-cloak>
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" @click="userModalOpen = false"></div>
        <div class="relative bg-white rounded-xl shadow-2xl w-full max-w-md p-6 animate-float">
            <h3 class="text-xl font-bold text-slate-800 mb-4" x-text="isEditingUser ? 'Edit User' : 'Create User'"></h3>
            <div class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Username</label>
                        <input type="text" x-model="userForm.username" :disabled="isEditingUser" class="w-full px-3 py-2 border border-slate-200 rounded focus:ring-2 focus:ring-anita-500 outline-none disabled:bg-slate-100">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Display Name</label>
                        <input type="text" x-model="userForm.display_name" class="w-full px-3 py-2 border border-slate-200 rounded focus:ring-2 focus:ring-anita-500 outline-none">
                    </div>
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Role</label>
                    <select x-model="userForm.role" class="w-full px-3 py-2 border border-slate-200 rounded focus:ring-2 focus:ring-anita-500 outline-none bg-white">
                        <template x-for="r in roles" :key="r.role_name">
                            <option :value="r.role_name" x-text="r.role_name"></option>
                        </template>
                    </select>
                </div>
                <div x-show="!isEditingUser">
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Password</label>
                    <input type="password" x-model="userForm.password" class="w-full px-3 py-2 border border-slate-200 rounded focus:ring-2 focus:ring-anita-500 outline-none">
                </div>
                <div x-show="isEditingUser" class="flex items-center gap-2 pt-2">
                    <input type="checkbox" id="userDisabled" x-model="userForm.disabled" class="w-4 h-4 text-anita-600 rounded">
                    <label for="userDisabled" class="text-sm font-bold text-slate-600">Disable Account</label>
                </div>
            </div>
            <div class="mt-6 flex justify-end gap-3">
                <button @click="userModalOpen = false" class="px-4 py-2 text-sm font-bold text-slate-500 bg-slate-100 rounded hover:bg-slate-200">Cancel</button>
                <button @click="saveUser" class="px-4 py-2 text-sm font-bold text-white bg-anita-600 rounded hover:bg-anita-700">Save User</button>
            </div>
        </div>
    </div>

    <div x-show="passwordModalOpen" class="fixed inset-0 z-50 flex items-center justify-center" x-cloak>
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" @click="passwordModalOpen = false"></div>
        <div class="relative bg-white rounded-xl shadow-2xl w-full max-w-sm p-6 animate-float">
            <h3 class="text-lg font-bold text-slate-800 mb-4">Reset Password</h3>
            <p class="text-sm text-slate-500 mb-4">New password for <span class="font-bold" x-text="passwordForm.username"></span></p>
            <input type="password" x-model="passwordForm.new_password" placeholder="New Password" class="w-full px-3 py-2 border border-slate-200 rounded focus:ring-2 focus:ring-anita-500 outline-none mb-4">
            <div class="flex justify-end gap-3">
                <button @click="passwordModalOpen = false" class="px-4 py-2 text-sm font-bold text-slate-500 bg-slate-100 rounded hover:bg-slate-200">Cancel</button>
                <button @click="changePassword" class="px-4 py-2 text-sm font-bold text-white bg-slate-800 rounded hover:bg-slate-900">Update</button>
            </div>
        </div>
    </div>

    <div x-show="deleteModalOpen" class="fixed inset-0 z-50 flex items-center justify-center" x-cloak>
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" @click="deleteModalOpen = false"></div>
        <div class="relative bg-white rounded-xl shadow-2xl w-full max-w-sm p-6 text-center animate-float">
            <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4"><i class="fas fa-exclamation-triangle text-red-500 text-2xl"></i></div>
            <h3 class="text-lg font-bold text-slate-800 mb-2">Are you sure?</h3>
            <p class="text-sm text-slate-500 mb-6">Delete <span x-text="deleteTarget.id" class="font-mono font-bold text-slate-700"></span>? This cannot be undone.</p>
            <div class="flex justify-center gap-3">
                <button @click="deleteModalOpen = false" class="px-4 py-2 text-sm font-bold text-slate-600 bg-slate-100 rounded hover:bg-slate-200">Cancel</button>
                <button @click="doDelete" class="px-4 py-2 text-sm font-bold text-white bg-red-500 rounded hover:bg-red-600 shadow-lg">Yes, Delete</button>
            </div>
        </div>
    </div>
</body>
</html>